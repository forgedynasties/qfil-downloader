{% extends "base.html" %}

{% block title %}{{ project.name }} - Project Details{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="/">
                        <i class="fas fa-home"></i> Home
                    </a>
                </li>
                <li class="breadcrumb-item active">{{ project.name }}</li>
            </ol>
        </nav>

        <!-- Project Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="display-5">
                    <i class="fas fa-folder me-3"></i>
                    {{ project.name }}
                </h1>
                {% if project.description %}
                <p class="text-muted fs-5">{{ project.description }}</p>
                {% endif %}
                <p class="text-muted">
                    <i class="fas fa-folder-open me-1"></i>
                    <code>{{ project.path }}</code>
                </p>
            </div>
            <a href="/download/{{ project.name }}" class="btn btn-success btn-lg download-btn">
                <i class="fas fa-download me-2"></i>
                Download Package
            </a>
        </div>

        <!-- Project Statistics -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-file fa-2x mb-2"></i>
                        <h3>{{ project.total_files }}</h3>
                        <p class="mb-0">Total Files</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-weight-hanging fa-2x mb-2"></i>
                        <h3>{{ format_size(project.total_size) }}</h3>
                        <p class="mb-0">Total Size</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                        <h3>Ready</h3>
                        <p class="mb-0">Status</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Listing -->
        {% if project.files %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    Package Contents ({{ project.total_files }} files)
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>
                                    <i class="fas fa-file me-1"></i>
                                    File Name
                                </th>
                                <th>
                                    <i class="fas fa-folder me-1"></i>
                                    Path
                                </th>
                                <th>
                                    <i class="fas fa-weight-hanging me-1"></i>
                                    Size
                                </th>
                                <th>
                                    <i class="fas fa-clock me-1"></i>
                                    Modified
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for file in project.files %}
                            <tr>
                                <td>
                                    <i class="fas fa-file-alt text-muted me-2"></i>
                                    <strong>{{ file.name }}</strong>
                                </td>
                                <td>
                                    <code class="text-muted">{{ file.path }}</code>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">
                                        {{ format_size(file.size) }}
                                    </span>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {{ file.modified.strftime('%Y-%m-%d %H:%M:%S') }}
                                    </small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-warning">
            <h5 class="alert-heading">
                <i class="fas fa-exclamation-triangle me-2"></i>
                No Files Found
            </h5>
            <p class="mb-0">
                This project directory appears to be empty or inaccessible.
            </p>
        </div>
        {% endif %}

        <!-- Download Instructions -->
        <div class="card mt-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Download Instructions
                </h5>
            </div>
            <div class="card-body">
                <ol>
                    <li>Click the "Download Package" button above</li>
                    <li>Your browser will download a ZIP file containing all QFIL files</li>
                    <li>Extract the ZIP file to your desired location</li>
                    <li>Use the extracted files with your QFIL tool</li>
                </ol>
                <div class="alert alert-info mt-3">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Tip:</strong> The ZIP file is generated on-demand and temporarily stored on the server. 
                    It will be automatically cleaned up after download.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add loading animation to download button
document.addEventListener('DOMContentLoaded', function() {
    const downloadButton = document.querySelector('.download-btn');
    
    if (downloadButton) {
        downloadButton.addEventListener('click', function() {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Preparing Download...';
            this.disabled = true;
            
            // Re-enable button after 10 seconds
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
            }, 10000);
        });
    }
});
</script>
{% endblock %}